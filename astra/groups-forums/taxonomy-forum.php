<?php
/**
 * The template for displaying taxonomy-forum pages.
 *
 * @link https://codex.wordpress.org/Template_Hierarchy
 *
 * @package Astra
 * @since 1.0.0
 */

if ( ! defined( 'ABSPATH' ) ) {
	exit; // Exit if accessed directly.
}

get_header(); ?>

<?php if ( astra_page_layout() == 'left-sidebar' ) : ?>

	<?php get_sidebar(); ?>

<?php endif ?>

	<div id="primary" <?php astra_primary_class(); ?>>

		<?php astra_primary_content_top(); ?>

		<?php astra_archive_header(); ?>

		<?php
			if ( is_tax() ) {
				global $wp_query;
				if ( $forum = $wp_query->get_queried_object() ) {
					if ( $forum && !is_wp_error( $forum ) ) {
						$user_id  = get_current_user_id();
						if ( Groups_Forums::user_can_post( $user_id, $forum->term_id ) ) {
							$edit_topic_post_id = Groups_Options::get_option( 'groups-forums-edit-topic-post-id', null );
							if ( $edit_topic_post_id ) {
								$link = add_query_arg( 'forum_id', $forum->term_id, get_permalink( $edit_topic_post_id ) );
								echo '<div class="new-topic">';
								echo sprintf( '<a href="%s">%s</a>', $link, __( 'Post a new Topic', GROUPS_FORUMS_PLUGIN_DOMAIN ) );
								echo '</div>';
								echo '<br/>';
							}
						}
					}
				}
			}
		?>

		<?php astra_content_loop(); ?>

		<?php astra_pagination(); ?>

		<?php astra_primary_content_bottom(); ?>

	</div><!-- #primary -->

<?php if ( astra_page_layout() == 'right-sidebar' ) : ?>

	<?php get_sidebar(); ?>

<?php endif ?>

<?php get_footer(); ?>
